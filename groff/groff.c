/* 
 * Groff challenge
 * Originally written by logray `the rogue challenge ;)`
 *
 * This code has to be compiled with with PIE, NX and CANARY enabled.
 * This code prints part of the stack as a "debug" feature, basically
 * creating a memory leak. The objective of the challenge is to spawn
 * a full-fledged shell bypassing all of the memory protections put in place.
 *
 */ 


#include <stdio.h>

void groff() {
	system("/bin/cat /root/ImHiding"); // can be modified, not really necessary though
}

int main() {
	char b[32];
	long i;
	long *ptr;
	ptr = &i;
	printf("=== DEBUG ===\n");  // print debugging header
	printf("- %018p\t- %018p\n", &groff, &i); // prints memory address of the groff function and i variable
	for (i=0;i<9;i++) {
		printf("- %018p\t- %018p\n", *ptr++, *ptr++); // prints up to 9 addresses after i variable address
	}
	printf ("=== END DEBUG ===\n\nEnter module to load: ");
	gets(b); // stack bof vulnerable input
	printf("module \"%s\" not found\n\n", b);
	return 0;
}
